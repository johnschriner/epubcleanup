<!doctype html>
<html>
<head>
  <title>Correction Result</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    table.diff { font-family: monospace; white-space: pre-wrap; }
    #editor-container { height: 400px; background: white; margin-bottom: 1em; }
  </style>
</head>
<body>
  <h1>Corrected Text Diff</h1>
  <div>{{ diff|safe }}</div>

  <h2>Edit Corrected Text Below</h2>

  <form method="post" action="/save">
    <!-- Quill Toolbar -->
    <div id="toolbar">
      <span class="ql-formats">
        <select class="ql-header">
          <option selected></option>
          <option value="1"></option>
          <option value="2"></option>
        </select>
        <button class="ql-bold"></button>
        <button class="ql-italic"></button>
        <button class="ql-underline"></button>
      </span>
    </div>

    <!-- Quill Editor -->
    <div id="editor-container"></div>
  <script>
    const correctedHTML = `{{ corrected_html|safe | replace("\n", "\\n") | replace("`", "\\`") }}`;
  </script>

    <!-- Hidden form fields -->
    <input type="hidden" name="edited_text" id="edited_text">
    <input type="hidden" name="original_file" value="{{ original_file }}">
    <br>
    <input type="submit" value="Save Changes & Download EPUB">
  </form>

  <!-- Quill JS -->
  <script>
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: { toolbar: '#toolbar' }
    });

  // Load the full corrected HTML AFTER Quill is initialized
  quill.root.innerHTML = correctedHTML;

  // On submit, inject edited HTML
  document.querySelector('form').addEventListener('submit', function(event) {
    document.getElementById('edited_text').value = quill.root.innerHTML;
  });
</script>
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      modules: {
        toolbar: '#toolbar'
      }
    });

    document.querySelector('form').addEventListener('submit', function(event) {
      const html = quill.root.innerHTML;
      document.getElementById('edited_text').value = html;
    });
  </script>
</body>
</html>
